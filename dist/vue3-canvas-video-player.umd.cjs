(function(e,m){typeof exports=="object"&&typeof module<"u"?module.exports=m(require("vue")):typeof define=="function"&&define.amd?define(["vue"],m):(e=typeof globalThis<"u"?globalThis:e||self,e.Vue3CanvasVideoPlayer=m(e.Vue))})(this,function(e){"use strict";const m=s=>{const a=parseInt(s),r=Math.floor(a/3600),c=Math.floor(a%3600/60),h=a%60;return`${r<10?"0"+r:r}:${c<10?"0"+c:c}:${h<10?"0"+h:h}`},f=s=>Math.round(s*props.fps),x=s=>s/props.fps,k=s=>s===void 0?!1:new Intl.NumberFormat().format(s),st="",ae=(s,a)=>{const r=s.__vccOpts||s;for(const[c,h]of a)r[c]=h;return r},d=s=>(e.pushScopeId("data-v-2625e36c"),s=s(),e.popScopeId(),s),ie=["data-dark-mode","data-type"],le={class:"header"},se=d(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),re={key:0},de=d(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),ce=d(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),me={key:0},fe=d(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),he={class:"main"},pe=["src","muted","autoplay"],ue={class:"seek"},_e={class:"drag"},ge=["src"],be={class:"time"},we={class:"controller"},ke=["title"],ve={key:0,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},ye=[d(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),d(()=>e.createElementVNode("path",{d:"M7 4v16l13 -8z"},null,-1))],Ve={key:1,class:"icon",viewBox:"0 0 24 24","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ee=[d(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),d(()=>e.createElementVNode("rect",{x:"6",y:"5",width:"4",height:"14",rx:"1"},null,-1)),d(()=>e.createElementVNode("rect",{x:"14",y:"5",width:"4",height:"14",rx:"1"},null,-1))],xe={class:"volume"},Ne=["title"],Me={key:0,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Be=[d(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),d(()=>e.createElementVNode("path",{d:"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a0.8 .8 0 0 1 1.5 .5v14a0.8 .8 0 0 1 -1.5 .5l-3.5 -4.5"},null,-1)),d(()=>e.createElementVNode("path",{d:"M16 10l4 4m0 -4l-4 4"},null,-1))],Te={key:1,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Se=[d(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),d(()=>e.createElementVNode("path",{d:"M15 8a5 5 0 0 1 0 8"},null,-1)),d(()=>e.createElementVNode("path",{d:"M17.7 5a9 9 0 0 1 0 14"},null,-1)),d(()=>e.createElementVNode("path",{d:"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a0.8 .8 0 0 1 1.5 .5v14a0.8 .8 0 0 1 -1.5 .5l-3.5 -4.5"},null,-1))],Ce={class:"drag"},ze=[d(()=>e.createElementVNode("svg",{class:"icon",viewBox:"-1 -1 26 26","stroke-width":"1",stroke:"#ffffff",fill:"none"},[e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.createElementVNode("path",{d:"M20 5v14l-12 -7z"}),e.createElementVNode("line",{x1:"4",y1:"5",x2:"4",y2:"19"})],-1))],$e=[d(()=>e.createElementVNode("svg",{class:"icon",viewBox:"-1 -1 26 26","stroke-width":"1",stroke:"#ffffff",fill:"none"},[e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.createElementVNode("path",{d:"M4 5v14l12 -7z"}),e.createElementVNode("line",{x1:"20",y1:"5",x2:"20",y2:"19"})],-1))],Re=d(()=>e.createElementVNode("div",{style:{flex:"1"}},null,-1)),De={class:"playback-rate"},Fe={class:"text"},He={class:"list"},Pe={class:"item"},Le=["onClick"],Ie=["title"],We={key:0,class:"icon",viewBox:"-4 -4 32 32","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ae=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-2625e36c></path><path d="M3 12h7l-3 -3m0 6l3 -3" data-v-2625e36c></path><path d="M21 12h-7l3 -3m0 6l-3 -3" data-v-2625e36c></path><path d="M9 6v-3h6v3" data-v-2625e36c></path><path d="M9 18v3h6v-3" data-v-2625e36c></path>',5)],je={key:1,class:"icon",viewBox:"-4 -4 32 32","stroke-width":"1",stroke:"#ffffff",fill:"none"},qe=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-2625e36c></path><path d="M10 12h-7l3 -3m0 6l-3 -3" data-v-2625e36c></path><path d="M14 12h7l-3 -3m0 6l3 -3" data-v-2625e36c></path><path d="M3 6v-3h18v3" data-v-2625e36c></path><path d="M3 18v3h18v-3" data-v-2625e36c></path>',5)],Oe=["title"],Ue=[e.createStaticVNode('<svg class="icon" viewBox="-4 -4 32 32" stroke-width="1" stroke="#ffffff" fill="none" data-v-2625e36c><path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-2625e36c></path><circle cx="5" cy="5" r="2" data-v-2625e36c></circle><circle cx="19" cy="5" r="2" data-v-2625e36c></circle><circle cx="5" cy="19" r="2" data-v-2625e36c></circle><circle cx="19" cy="19" r="2" data-v-2625e36c></circle><line x1="5" y1="7" x2="5" y2="17" data-v-2625e36c></line><line x1="7" y1="5" x2="17" y2="5" data-v-2625e36c></line><line x1="7" y1="19" x2="17" y2="19" data-v-2625e36c></line><line x1="19" y1="7" x2="19" y2="17" data-v-2625e36c></line></svg>',1)],Ge=["title"],Ke={key:0,class:"icon",viewBox:"0 0 24 24","stroke-width":"1",stroke:"#ffffff",fill:"none"},Je=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-2625e36c></path><path d="M15 19v-2a2 2 0 0 1 2 -2h2" data-v-2625e36c></path><path d="M15 5v2a2 2 0 0 0 2 2h2" data-v-2625e36c></path><path d="M5 15h2a2 2 0 0 1 2 2v2" data-v-2625e36c></path><path d="M5 9h2a2 2 0 0 0 2 -2v-2" data-v-2625e36c></path>',5)],Qe={key:1,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ye=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-2625e36c></path><path d="M4 8v-2a2 2 0 0 1 2 -2h2" data-v-2625e36c></path><path d="M4 16v2a2 2 0 0 0 2 2h2" data-v-2625e36c></path><path d="M16 4h2a2 2 0 0 1 2 2v2" data-v-2625e36c></path><path d="M16 20h2a2 2 0 0 0 2 -2v-2" data-v-2625e36c></path>',5)],Ze={class:"message"},Xe=["innerHTML"];return ae({__name:"Vue3CanvasVideoPlayer",props:{src:{type:String,default:"",required:!0},muted:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},range:{type:Array,default(){return[]}},fps:{type:Number,default:0},bbox:{type:Object,default(){return{}}},type:{type:String,default:"overlay"},messageTime:{type:Number,default:1e3},preview:{type:Boolean,default:!1},darkMode:{type:Boolean,default:!0}},setup(s){const a=s,r=e.computed(()=>a.range[0]>0&&a.range[1]>0),c=e.computed(()=>a.fps>0),h=e.computed(()=>{var o;return((o=a.bbox)==null?void 0:o.data)&&Object.keys(a.bbox.data).length>0}),b=e.ref(null),v=e.ref(null),N=e.ref(null),V=e.ref(null),M=e.ref(null),t=e.reactive({main:{video:null,canvas:null,context:null,width:0,height:0,paused:!0,muted:!1,volume:1,playbackRate:1,fullScreen:!1,currentTime:0,duration:0,ended:!1},seek:{width:0,total:0},range:{enabled:!1,left:0,width:0},bbox:{enabled:!1,data:{},borderSize:1,borderColor:"rgba(255, 0, 0, 0.5)",fillColor:"rgba(0, 0, 255, 0.5)"},message:{visible:!1,text:""},preview:{element:null,context:null,left:0,time:"00:00:00"},mouse:{down:!1,move:!1,hold:!1}}),et=()=>{var Y,Z,X;Object.assign(t,{main:{...t.main,video:v.value,canvas:N.value,context:N.value.getContext("2d"),width:v.value.videoWidth,height:v.value.videoHeight,paused:!(a.muted===!0&&a.autoplay===!0),muted:a.muted,duration:v.value.duration},seek:{...t.seek,total:b.value.offsetWidth},range:{...t.range,enabled:r.value},bbox:{...t.bbox,...a.bbox,enabled:h.value},preview:{...t.preview,video:V.value,canvas:M.value,context:(Y=M.value)==null?void 0:Y.getContext("2d"),width:(Z=V.value)==null?void 0:Z.videoWidth,height:(X=V.value)==null?void 0:X.videoHeight}});const{main:{video:o,canvas:n,context:i,width:l,height:u,duration:w},preview:{video:g,canvas:U,context:G}}=t,K=l*.3,J=u*.3;n.width=l,n.height=u,a.preview&&(U.width=K,U.height=J),r.value&&(o.currentTime=a.range[0]);const Q=()=>{const{range:{enabled:it}}=t;i.drawImage(o,0,0,l,u),a.preview&&(G.imageSmoothingEnabled=!0,G.drawImage(g,0,0,K,J));const z=t.main.currentTime=o.currentTime;if(I(),r.value&&it?t.seek.width=((z-a.range[0])/(a.range[1]-a.range[0])*100).toFixed(10):t.seek.width=(z/w*100).toFixed(10),o.paused&&Math.floor(t.seek.width)===100&&(t.main.paused=!0),c&&h&&t.bbox.enabled){const lt=f(z),_=t.bbox.data[lt];if(_&&_.length===4){const ee=_[0],te=_[1],ne=_[2]-_[0],oe=_[3]-_[1];i.fillStyle=t.bbox.fillColor,i.fillRect(ee,te,ne,oe),t.bbox.borderSize&&(i.lineWidth=t.bbox.borderSize,i.strokeStyle=t.bbox.borderColor,i.strokeRect(ee-t.bbox.borderSize/2,te-t.bbox.borderSize/2,ne+t.bbox.borderSize,oe+t.bbox.borderSize))}}window.requestAnimationFrame(Q)};Q(),window.dispatchEvent(new Event("resize"))};let B;const p=o=>{if(!a.messageTime)return;const{message:n}=t;n.text=o,n.visible=!0,B&&clearTimeout(B),B=setTimeout(()=>{n.visible=!1},a.messageTime)},$=({offsetX:o})=>{const{main:{duration:n},seek:{total:i},preview:{video:l},range:{enabled:u},mouse:{down:w}}=t,g=u?o/i*(a.range[1]-a.range[0])+a.range[0]:o/i*n;w&&y(g),a.preview&&(l.currentTime=g,t.preview.time=m(g),o<65?t.preview.left=65:o>i-65?t.preview.left=i-65:t.preview.left=o)};let R;const D=({detail:o})=>{if(o===1){const{main:{video:n,paused:i},range:{enabled:l}}=t;R=setTimeout(()=>{i?(r.value&&l&&n.currentTime===a.range[1]&&(n.currentTime=a.range[0]),n.play()):n.pause(),p(i?"Play":"Pause"),t.main.paused=!i},250)}else o===2&&(clearTimeout(R),A())},T=o=>{const{main:{video:n}}=t,i=Math.max(Math.min(o,1),0);n.volume=t.main.volume=i,p(`Volume ${Math.floor(i*100)}%`)},F=({offsetY:o})=>{const{mouse:{down:n}}=t;n&&T((100-o)/100)},tt=()=>{const{main:{video:o,muted:n}}=t;o.muted=t.main.muted=!n,p(n?"Unmuted":"Muted")},y=o=>{const{main:{video:n,duration:i},range:{enabled:l}}=t;n.currentTime=r.value&&l?Math.max(Math.min(o,a.range[1]),a.range[0]):Math.max(Math.min(o,i),0),p(`Seek ${m(n.currentTime)} ${c.value?`[${k(f(n.currentTime))}]`:""} (${r.value&&l?Math.round((n.currentTime-a.range[0])/(a.range[1]-a.range[0])*100):Math.round(n.currentTime/i*100)}%)`)},H=()=>{const{main:{video:o}}=t;c.value?y(x(f(o.currentTime)+1)):y(o.currentTime+1)},P=()=>{const{main:{video:o}}=t;c.value?y(x(f(o.currentTime)-1)):y(o.currentTime-1)};let L;const E=o=>{const{mouse:{down:n}}=t;n?L=setInterval(()=>{o?H():P()},60):clearInterval(L)},nt=o=>{const{main:{video:n}}=t;n.playbackRate=t.main.playbackRate=o,p(`Playback Rate x${o.toFixed(1)}`)},ot=()=>{const{bbox:{enabled:o}}=t;t.bbox.enabled=!o,p(o?"Hide bounding box":"Show bounding box")},I=()=>{const{main:{video:o},range:{enabled:n}}=t;!(r.value&&n)||(o.currentTime<a.range[0]&&(o.currentTime=a.range[0]),o.currentTime>a.range[1]&&(o.currentTime=a.range[1],o.pause(),t.main.paused=!0))},W=()=>{const{main:{duration:o},seek:{total:n},range:{enabled:i}}=t;I(),t.range.left=r.value&&i?0:a.range[0]/o*n,t.range.width=r.value&&i?n:a.range[1]/o*n-a.range[0]/o*n},at=()=>{const{range:{enabled:o}}=t;t.range.enabled=!o,W(),p(o?"Inactive range":"Active range")},A=()=>{document.fullscreenElement?document.exitFullscreen():b.value.requestFullscreen()},j=()=>{t.seek.total=b.value.offsetWidth,r.value&&W(),a.preview&&(t.preview.left=0)},q=({altKey:o,ctrlKey:n,key:i})=>{const{main:{video:l,paused:u,volume:w}}=t;if(o&&n){if(i==="g"&&c.value){const g=window.prompt("Go to frame number",f(l.currentTime));u&&l.pause(),l.currentTime=x(g)}i==="ArrowUp"&&T(w+.05),i==="ArrowDown"&&T(w-.05),i==="ArrowLeft"&&P(),i==="ArrowRight"&&H()}},O=()=>{t.main.fullScreen=Boolean(document.fullscreenElement),p(`${t.main.fullScreen?"Full":"Normal"} screen`)};let S;const C=()=>{S&&clearTimeout(S),t.mouse.move=!0,!t.mouse.hold&&(S=setTimeout(()=>{t.mouse.move=!1},1e3))};return e.onMounted(()=>{window.addEventListener("resize",j),window.addEventListener("keydown",q),document.addEventListener("fullscreenchange",O),a.type==="overlay"&&b.value.addEventListener("mousemove",C)}),e.onUnmounted(()=>{var o;window.removeEventListener("resize",j),window.removeEventListener("keydown",q),document.removeEventListener("fullscreenchange",O),a.type==="overlay"&&((o=b.value)==null||o.removeEventListener("mousemove",C))}),(o,n)=>{var i;return e.openBlock(),e.createElementBlock("div",{id:"vue3-canvas-video-player",ref_key:"containerRef",ref:b,"data-dark-mode":s.darkMode,"data-type":a.type},[e.createElementVNode("div",le,[e.createElementVNode("div",{class:e.normalizeClass(["time",!t.range.enabled&&"active"])},[e.createElementVNode("span",null,e.toDisplayString(e.unref(m)(t.main.currentTime)),1),se,e.createElementVNode("span",null,e.toDisplayString(e.unref(m)(t.main.duration)),1),e.unref(c)?(e.openBlock(),e.createElementBlock("span",re,[e.createElementVNode("span",null," [ "+e.toDisplayString(e.unref(k)(e.unref(f)(t.main.currentTime))),1),de,e.createElementVNode("span",null,e.toDisplayString(e.unref(k)(e.unref(f)(t.main.duration)))+" ]",1)])):e.createCommentVNode("",!0)],2),e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["time",t.range.enabled&&"active"])},[e.createElementVNode("span",null,e.toDisplayString(e.unref(m)(t.main.currentTime)),1),ce,e.createElementVNode("span",null,e.toDisplayString(e.unref(m)(a.range[1])),1),e.unref(c)?(e.openBlock(),e.createElementBlock("span",me,[e.createElementVNode("span",null," [ "+e.toDisplayString(e.unref(k)(e.unref(f)(t.main.currentTime))),1),fe,e.createElementVNode("span",null,e.toDisplayString(e.unref(k)(e.unref(f)(a.range[1])))+" ]",1)])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]),e.createElementVNode("div",he,[e.createElementVNode("video",{class:"video-hidden",ref_key:"mainVideoRef",ref:v,src:s.src,muted:s.muted,autoplay:s.autoplay,onLoadedmetadata:et},null,40,pe),e.createElementVNode("canvas",{class:"canvas",ref_key:"mainCanvasRef",ref:N,onClick:D},null,512)]),e.createElementVNode("div",{class:e.normalizeClass(["footer",t.mouse.move&&"active"]),onMouseenter:n[10]||(n[10]=l=>t.mouse.hold=!0),onMouseleave:n[11]||(n[11]=l=>{t.mouse.hold=!1,C()})},[e.createElementVNode("div",ue,[e.createElementVNode("div",_e,[e.createElementVNode("div",{class:"area",onMousedown:n[0]||(n[0]=e.withModifiers(l=>{t.mouse.down=!0,$(l)},["self"])),onMousemove:$,onMouseup:n[1]||(n[1]=l=>t.mouse.down=!1),onMouseleave:n[2]||(n[2]=l=>t.mouse.down=!1)},[e.createElementVNode("div",{class:"bar",style:e.normalizeStyle({width:`${t.seek.width}%`})},null,4),e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"range",style:e.normalizeStyle({left:`${t.range.left}px`,width:`${t.range.width}px`})},null,4)):e.createCommentVNode("",!0)],32)]),a.preview?(e.openBlock(),e.createElementBlock("div",{key:0,class:"preview",style:e.normalizeStyle({left:`${t.preview.left}px`})},[e.createElementVNode("video",{class:"video-hidden",ref_key:"previewVideoRef",ref:V,src:s.src},null,8,ge),e.createElementVNode("canvas",{class:"canvas",ref_key:"previewCanvasRef",ref:M},null,512),e.createElementVNode("div",be,e.toDisplayString(t.preview.time),1)],4)):e.createCommentVNode("",!0)]),e.createElementVNode("div",we,[e.createElementVNode("button",{class:"control-button",title:t.main.paused?"Play":"Pause",onClick:D},[t.main.paused?(e.openBlock(),e.createElementBlock("svg",ve,ye)):(e.openBlock(),e.createElementBlock("svg",Ve,Ee))],8,ke),e.createElementVNode("div",xe,[e.createElementVNode("button",{class:"control-button",title:t.main.muted?"Unmute":"Mute",onClick:tt},[t.main.muted?(e.openBlock(),e.createElementBlock("svg",Me,Be)):(e.openBlock(),e.createElementBlock("svg",Te,Se))],8,Ne),e.createElementVNode("div",Ce,[e.createElementVNode("div",{class:"area",onMousedown:n[3]||(n[3]=e.withModifiers(l=>{t.mouse.down=!0,F(l)},["self"])),onMousemove:F,onMouseup:n[4]||(n[4]=l=>t.mouse.down=!1),onMouseleave:n[5]||(n[5]=l=>t.mouse.down=!1)},[e.createElementVNode("div",{class:"bar",style:e.normalizeStyle({height:`${t.main.volume*100}%`})},null,4)],32)])]),e.createElementVNode("button",{class:"control-button",title:"Backward",onMousedown:n[6]||(n[6]=l=>{t.mouse.down=!0,E(!1)}),onMouseup:n[7]||(n[7]=l=>{t.mouse.down=!1,E(!1)})},ze,32),e.createElementVNode("button",{class:"control-button",title:"Forward",onMousedown:n[8]||(n[8]=l=>{t.mouse.down=!0,E(!0)}),onMouseup:n[9]||(n[9]=l=>{t.mouse.down=!1,E(!0)})},$e,32),Re,e.createElementVNode("div",De,[e.createElementVNode("div",Fe,"x"+e.toDisplayString(((i=t.main.playbackRate)==null?void 0:i.toFixed(1))||"1.0"),1),e.createElementVNode("ul",He,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList([.1,.5,1,1.5,2,5],l=>(e.openBlock(),e.createElementBlock("li",Pe,[e.createElementVNode("button",{class:"button",onClick:u=>nt(l)},e.toDisplayString(l.toFixed(1)),9,Le)]))),256))])]),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"control-button",title:t.range.enabled?"Reset range":"Set range",onClick:at},[t.range.enabled?(e.openBlock(),e.createElementBlock("svg",We,Ae)):(e.openBlock(),e.createElementBlock("svg",je,qe))],8,Ie)):e.createCommentVNode("",!0),e.unref(c)&&e.unref(h)?(e.openBlock(),e.createElementBlock("button",{key:1,class:e.normalizeClass(["control-button",t.bbox.enabled&&"active"]),title:t.bbox.enabled?"Hide bounding box":"Show bounding box",onClick:ot},Ue,10,Oe)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"control-button",title:t.main.fullScreen?"Normal screen":"Full screen",onClick:A},[t.main.fullScreen?(e.openBlock(),e.createElementBlock("svg",Ke,Je)):(e.openBlock(),e.createElementBlock("svg",Qe,Ye))],8,Ge)])],34),e.createElementVNode("div",Ze,[e.createElementVNode("div",{class:e.normalizeClass(["text",t.message.visible?"show":"hide"]),innerHTML:t.message.text},null,10,Xe)])],8,ie)}}},[["__scopeId","data-v-2625e36c"]])});

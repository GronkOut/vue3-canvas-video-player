(function(e,V){typeof exports=="object"&&typeof module<"u"?module.exports=V(require("vue")):typeof define=="function"&&define.amd?define(["vue"],V):(e=typeof globalThis<"u"?globalThis:e||self,e.Vue3CanvasVideoPlayer=V(e.Vue))})(this,function(e){"use strict";const V="",ie=(d,a)=>{const r=d.__vccOpts||d;for(const[m,w]of a)r[m]=w;return r},s=d=>(e.pushScopeId("data-v-846c9f11"),d=d(),e.popScopeId(),d),le=["data-dark-mode","data-type"],se={class:"header"},re=s(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),de={key:0},ce=s(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),me=s(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),fe={key:0},he=s(()=>e.createElementVNode("span",{style:{opacity:"0.5"}}," / ",-1)),pe={class:"main"},ue=["src","muted","autoplay"],_e={class:"seek"},ge={class:"drag"},be=["src"],we={class:"time"},ve={class:"controller"},ke=["title"],ye={key:0,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ve=[s(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),s(()=>e.createElementVNode("path",{d:"M7 4v16l13 -8z"},null,-1))],Ee={key:1,class:"icon",viewBox:"0 0 24 24","stroke-width":"1",stroke:"#ffffff",fill:"none"},xe=[s(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),s(()=>e.createElementVNode("rect",{x:"6",y:"5",width:"4",height:"14",rx:"1"},null,-1)),s(()=>e.createElementVNode("rect",{x:"14",y:"5",width:"4",height:"14",rx:"1"},null,-1))],Ne={class:"volume"},Me=["title"],Be={key:0,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Te=[s(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),s(()=>e.createElementVNode("path",{d:"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a0.8 .8 0 0 1 1.5 .5v14a0.8 .8 0 0 1 -1.5 .5l-3.5 -4.5"},null,-1)),s(()=>e.createElementVNode("path",{d:"M16 10l4 4m0 -4l-4 4"},null,-1))],Se={key:1,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ce=[s(()=>e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1)),s(()=>e.createElementVNode("path",{d:"M15 8a5 5 0 0 1 0 8"},null,-1)),s(()=>e.createElementVNode("path",{d:"M17.7 5a9 9 0 0 1 0 14"},null,-1)),s(()=>e.createElementVNode("path",{d:"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a0.8 .8 0 0 1 1.5 .5v14a0.8 .8 0 0 1 -1.5 .5l-3.5 -4.5"},null,-1))],ze={class:"drag"},$e=[s(()=>e.createElementVNode("svg",{class:"icon",viewBox:"-1 -1 26 26","stroke-width":"1",stroke:"#ffffff",fill:"none"},[e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.createElementVNode("path",{d:"M20 5v14l-12 -7z"}),e.createElementVNode("line",{x1:"4",y1:"5",x2:"4",y2:"19"})],-1))],Re=[s(()=>e.createElementVNode("svg",{class:"icon",viewBox:"-1 -1 26 26","stroke-width":"1",stroke:"#ffffff",fill:"none"},[e.createElementVNode("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.createElementVNode("path",{d:"M4 5v14l12 -7z"}),e.createElementVNode("line",{x1:"20",y1:"5",x2:"20",y2:"19"})],-1))],De=s(()=>e.createElementVNode("div",{style:{flex:"1"}},null,-1)),Fe={class:"playback-rate"},He={class:"text"},Pe={class:"list"},Le={class:"item"},Ie=["onClick"],We=["title"],Ae={key:0,class:"icon",viewBox:"-4 -4 32 32","stroke-width":"1",stroke:"#ffffff",fill:"none"},je=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-846c9f11></path><path d="M3 12h7l-3 -3m0 6l3 -3" data-v-846c9f11></path><path d="M21 12h-7l3 -3m0 6l-3 -3" data-v-846c9f11></path><path d="M9 6v-3h6v3" data-v-846c9f11></path><path d="M9 18v3h6v-3" data-v-846c9f11></path>',5)],qe={key:1,class:"icon",viewBox:"-4 -4 32 32","stroke-width":"1",stroke:"#ffffff",fill:"none"},Oe=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-846c9f11></path><path d="M10 12h-7l3 -3m0 6l-3 -3" data-v-846c9f11></path><path d="M14 12h7l-3 -3m0 6l3 -3" data-v-846c9f11></path><path d="M3 6v-3h18v3" data-v-846c9f11></path><path d="M3 18v3h18v-3" data-v-846c9f11></path>',5)],Ue=["title"],Ge=[e.createStaticVNode('<svg class="icon" viewBox="-4 -4 32 32" stroke-width="1" stroke="#ffffff" fill="none" data-v-846c9f11><path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-846c9f11></path><circle cx="5" cy="5" r="2" data-v-846c9f11></circle><circle cx="19" cy="5" r="2" data-v-846c9f11></circle><circle cx="5" cy="19" r="2" data-v-846c9f11></circle><circle cx="19" cy="19" r="2" data-v-846c9f11></circle><line x1="5" y1="7" x2="5" y2="17" data-v-846c9f11></line><line x1="7" y1="5" x2="17" y2="5" data-v-846c9f11></line><line x1="7" y1="19" x2="17" y2="19" data-v-846c9f11></line><line x1="19" y1="7" x2="19" y2="17" data-v-846c9f11></line></svg>',1)],Ke=["title"],Je={key:0,class:"icon",viewBox:"0 0 24 24","stroke-width":"1",stroke:"#ffffff",fill:"none"},Qe=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-846c9f11></path><path d="M15 19v-2a2 2 0 0 1 2 -2h2" data-v-846c9f11></path><path d="M15 5v2a2 2 0 0 0 2 2h2" data-v-846c9f11></path><path d="M5 15h2a2 2 0 0 1 2 2v2" data-v-846c9f11></path><path d="M5 9h2a2 2 0 0 0 2 -2v-2" data-v-846c9f11></path>',5)],Ye={key:1,class:"icon",viewBox:"-2 -2 28 28","stroke-width":"1",stroke:"#ffffff",fill:"none"},Ze=[e.createStaticVNode('<path stroke="none" d="M0 0h24v24H0z" fill="none" data-v-846c9f11></path><path d="M4 8v-2a2 2 0 0 1 2 -2h2" data-v-846c9f11></path><path d="M4 16v2a2 2 0 0 0 2 2h2" data-v-846c9f11></path><path d="M16 4h2a2 2 0 0 1 2 2v2" data-v-846c9f11></path><path d="M16 20h2a2 2 0 0 0 2 -2v-2" data-v-846c9f11></path>',5)],Xe={class:"message"},et=["innerHTML"];return ie({__name:"Vue3CanvasVideoPlayer",props:{src:{type:String,default:"",required:!0},muted:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},range:{type:Array,default(){return[]}},fps:{type:Number,default:0},bbox:{type:Object,default(){return{}}},type:{type:String,default:"overlay"},messageTime:{type:Number,default:1e3},preview:{type:Boolean,default:!1},darkMode:{type:Boolean,default:!0}},setup(d){const a=d,r=e.computed(()=>a.range[0]>0&&a.range[1]>0),m=e.computed(()=>a.fps>0),w=e.computed(()=>{var n;return((n=a.bbox)==null?void 0:n.data)&&Object.keys(a.bbox.data).length>0}),_=e.ref(null),v=e.ref(null),N=e.ref(null),E=e.ref(null),M=e.ref(null),t=e.reactive({main:{video:null,canvas:null,context:null,width:0,height:0,paused:!0,muted:!1,volume:1,playbackRate:1,fullScreen:!1,currentTime:0,duration:0,ended:!1},seek:{width:0,total:0},range:{enabled:!1,left:0,width:0},bbox:{enabled:!1,data:{},borderSize:1,borderColor:"rgba(255, 0, 0, 0.5)",fillColor:"rgba(0, 0, 255, 0.5)"},message:{visible:!1,text:""},preview:{element:null,context:null,left:0,time:"00:00:00"},mouse:{down:!1,move:!1,hold:!1}}),tt=()=>{var Z,X,ee;Object.assign(t,{main:{...t.main,video:v.value,canvas:N.value,context:N.value.getContext("2d"),width:v.value.videoWidth,height:v.value.videoHeight,paused:!(a.muted===!0&&a.autoplay===!0),muted:a.muted,duration:v.value.duration},seek:{...t.seek,total:_.value.offsetWidth},range:{...t.range,enabled:r.value},bbox:{...t.bbox,...a.bbox,enabled:w.value},preview:{...t.preview,video:E.value,canvas:M.value,context:(Z=M.value)==null?void 0:Z.getContext("2d"),width:(X=E.value)==null?void 0:X.videoWidth,height:(ee=E.value)==null?void 0:ee.videoHeight}});const{main:{video:n,canvas:o,context:i,width:l,height:c,duration:b},preview:{video:u,canvas:G,context:K}}=t,J=l*.3,Q=c*.3;o.width=l,o.height=c,a.preview&&(G.width=J,G.height=Q),r.value&&(n.currentTime=a.range[0]);const Y=()=>{const{range:{enabled:lt}}=t;i.drawImage(n,0,0,l,c),a.preview&&(K.imageSmoothingEnabled=!0,K.drawImage(u,0,0,J,Q));const $=t.main.currentTime=n.currentTime;if(W(),r.value&&lt?t.seek.width=(($-a.range[0])/(a.range[1]-a.range[0])*100).toFixed(10):t.seek.width=($/b*100).toFixed(10),n.paused&&Math.floor(t.seek.width)===100&&(t.main.paused=!0),m&&w&&t.bbox.enabled){const st=f($),p=t.bbox.data[st];if(p&&p.length===4){const te=p[0],ne=p[1],oe=p[2]-p[0],ae=p[3]-p[1];i.fillStyle=t.bbox.fillColor,i.fillRect(te,ne,oe,ae),t.bbox.borderSize&&(i.lineWidth=t.bbox.borderSize,i.strokeStyle=t.bbox.borderColor,i.strokeRect(te-t.bbox.borderSize/2,ne-t.bbox.borderSize/2,oe+t.bbox.borderSize,ae+t.bbox.borderSize))}}window.requestAnimationFrame(Y)};Y(),window.dispatchEvent(new Event("resize"))},g=n=>{const o=parseInt(n),i=Math.floor(o/3600),l=Math.floor(o%3600/60),c=o%60;return`${i<10?"0"+i:i}:${l<10?"0"+l:l}:${c<10?"0"+c:c}`},f=n=>Math.round(n*a.fps),B=n=>n/a.fps,k=n=>n===void 0?!1:new Intl.NumberFormat().format(n);let T;const h=n=>{if(!a.messageTime)return;const{message:o}=t;o.text=n,o.visible=!0,T&&clearTimeout(T),T=setTimeout(()=>{o.visible=!1},a.messageTime)},R=({offsetX:n})=>{const{main:{duration:o},seek:{total:i},preview:{video:l},range:{enabled:c},mouse:{down:b}}=t,u=c?n/i*(a.range[1]-a.range[0])+a.range[0]:n/i*o;b&&y(u),a.preview&&(l.currentTime=u,t.preview.time=g(u),n<65?t.preview.left=65:n>i-65?t.preview.left=i-65:t.preview.left=n)};let D;const F=({detail:n})=>{if(n===1){const{main:{video:o,paused:i},range:{enabled:l}}=t;D=setTimeout(()=>{i?(r.value&&l&&o.currentTime===a.range[1]&&(o.currentTime=a.range[0]),o.play()):o.pause(),h(i?"Play":"Pause"),t.main.paused=!i},250)}else n===2&&(clearTimeout(D),j())},S=n=>{const{main:{video:o}}=t,i=Math.max(Math.min(n,1),0);o.volume=t.main.volume=i,h(`Volume ${Math.floor(i*100)}%`)},H=({offsetY:n})=>{const{mouse:{down:o}}=t;o&&S((100-n)/100)},nt=()=>{const{main:{video:n,muted:o}}=t;n.muted=t.main.muted=!o,h(o?"Unmuted":"Muted")},y=n=>{const{main:{video:o,duration:i},range:{enabled:l}}=t;o.currentTime=r.value&&l?Math.max(Math.min(n,a.range[1]),a.range[0]):Math.max(Math.min(n,i),0),h(`Seek ${g(o.currentTime)} ${m.value?`[${k(f(o.currentTime))}]`:""} (${r.value&&l?Math.round((o.currentTime-a.range[0])/(a.range[1]-a.range[0])*100):Math.round(o.currentTime/i*100)}%)`)},P=()=>{const{main:{video:n}}=t;m.value?y(B(f(n.currentTime)+1)):y(n.currentTime+1)},L=()=>{const{main:{video:n}}=t;m.value?y(B(f(n.currentTime)-1)):y(n.currentTime-1)};let I;const x=n=>{const{mouse:{down:o}}=t;o?I=setInterval(()=>{n?P():L()},60):clearInterval(I)},ot=n=>{const{main:{video:o}}=t;o.playbackRate=t.main.playbackRate=n,h(`Playback Rate x${n.toFixed(1)}`)},at=()=>{const{bbox:{enabled:n}}=t;t.bbox.enabled=!n,h(n?"Hide bounding box":"Show bounding box")},W=()=>{const{main:{video:n},range:{enabled:o}}=t;!(r.value&&o)||(n.currentTime<a.range[0]&&(n.currentTime=a.range[0]),n.currentTime>a.range[1]&&(n.currentTime=a.range[1],n.pause(),t.main.paused=!0))},A=()=>{const{main:{duration:n},seek:{total:o},range:{enabled:i}}=t;W(),t.range.left=r.value&&i?0:a.range[0]/n*o,t.range.width=r.value&&i?o:a.range[1]/n*o-a.range[0]/n*o},it=()=>{const{range:{enabled:n}}=t;t.range.enabled=!n,A(),h(n?"Inactive range":"Active range")},j=()=>{document.fullscreenElement?document.exitFullscreen():_.value.requestFullscreen()},q=()=>{t.seek.total=_.value.offsetWidth,r.value&&A(),a.preview&&(t.preview.left=0)},O=({altKey:n,ctrlKey:o,key:i})=>{const{main:{video:l,paused:c,volume:b}}=t;if(n&&o){if(i==="g"&&m.value){const u=window.prompt("Go to frame number",f(l.currentTime));c&&l.pause(),l.currentTime=B(u)}i==="ArrowUp"&&S(b+.05),i==="ArrowDown"&&S(b-.05),i==="ArrowLeft"&&L(),i==="ArrowRight"&&P()}},U=()=>{t.main.fullScreen=Boolean(document.fullscreenElement),h(`${t.main.fullScreen?"Full":"Normal"} screen`)};let C;const z=()=>{C&&clearTimeout(C),t.mouse.move=!0,!t.mouse.hold&&(C=setTimeout(()=>{t.mouse.move=!1},1e3))};return e.onMounted(()=>{window.addEventListener("resize",q),window.addEventListener("keydown",O),document.addEventListener("fullscreenchange",U),a.type==="overlay"&&_.value.addEventListener("mousemove",z)}),e.onUnmounted(()=>{var n;window.removeEventListener("resize",q),window.removeEventListener("keydown",O),document.removeEventListener("fullscreenchange",U),a.type==="overlay"&&((n=_.value)==null||n.removeEventListener("mousemove",z))}),(n,o)=>{var i;return e.openBlock(),e.createElementBlock("div",{id:"video-frame-canvas-player",ref_key:"containerRef",ref:_,"data-dark-mode":d.darkMode,"data-type":a.type},[e.createElementVNode("div",se,[e.createElementVNode("div",{class:e.normalizeClass(["time",!t.range.enabled&&"active"])},[e.createElementVNode("span",null,e.toDisplayString(g(t.main.currentTime)),1),re,e.createElementVNode("span",null,e.toDisplayString(g(t.main.duration)),1),e.unref(m)?(e.openBlock(),e.createElementBlock("span",de,[e.createElementVNode("span",null," [ "+e.toDisplayString(k(f(t.main.currentTime))),1),ce,e.createElementVNode("span",null,e.toDisplayString(k(f(t.main.duration)))+" ]",1)])):e.createCommentVNode("",!0)],2),e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["time",t.range.enabled&&"active"])},[e.createElementVNode("span",null,e.toDisplayString(g(t.main.currentTime)),1),me,e.createElementVNode("span",null,e.toDisplayString(g(a.range[1])),1),e.unref(m)?(e.openBlock(),e.createElementBlock("span",fe,[e.createElementVNode("span",null," [ "+e.toDisplayString(k(f(t.main.currentTime))),1),he,e.createElementVNode("span",null,e.toDisplayString(k(f(a.range[1])))+" ]",1)])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]),e.createElementVNode("div",pe,[e.createElementVNode("video",{class:"video-hidden",ref_key:"mainVideoRef",ref:v,src:d.src,muted:d.muted,autoplay:d.autoplay,onLoadedmetadata:tt},null,40,ue),e.createElementVNode("canvas",{class:"canvas",ref_key:"mainCanvasRef",ref:N,onClick:F},null,512)]),e.createElementVNode("div",{class:e.normalizeClass(["footer",t.mouse.move&&"active"]),onMouseenter:o[10]||(o[10]=l=>t.mouse.hold=!0),onMouseleave:o[11]||(o[11]=l=>{t.mouse.hold=!1,z()})},[e.createElementVNode("div",_e,[e.createElementVNode("div",ge,[e.createElementVNode("div",{class:"area",onMousedown:o[0]||(o[0]=e.withModifiers(l=>{t.mouse.down=!0,R(l)},["self"])),onMousemove:R,onMouseup:o[1]||(o[1]=l=>t.mouse.down=!1),onMouseleave:o[2]||(o[2]=l=>t.mouse.down=!1)},[e.createElementVNode("div",{class:"bar",style:e.normalizeStyle({width:`${t.seek.width}%`})},null,4),e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"range",style:e.normalizeStyle({left:`${t.range.left}px`,width:`${t.range.width}px`})},null,4)):e.createCommentVNode("",!0)],32)]),a.preview?(e.openBlock(),e.createElementBlock("div",{key:0,class:"preview",style:e.normalizeStyle({left:`${t.preview.left}px`})},[e.createElementVNode("video",{class:"video-hidden",ref_key:"previewVideoRef",ref:E,src:d.src},null,8,be),e.createElementVNode("canvas",{class:"canvas",ref_key:"previewCanvasRef",ref:M},null,512),e.createElementVNode("div",we,e.toDisplayString(t.preview.time),1)],4)):e.createCommentVNode("",!0)]),e.createElementVNode("div",ve,[e.createElementVNode("button",{class:"control-button",title:t.main.paused?"Play":"Pause",onClick:F},[t.main.paused?(e.openBlock(),e.createElementBlock("svg",ye,Ve)):(e.openBlock(),e.createElementBlock("svg",Ee,xe))],8,ke),e.createElementVNode("div",Ne,[e.createElementVNode("button",{class:"control-button",title:t.main.muted?"Unmute":"Mute",onClick:nt},[t.main.muted?(e.openBlock(),e.createElementBlock("svg",Be,Te)):(e.openBlock(),e.createElementBlock("svg",Se,Ce))],8,Me),e.createElementVNode("div",ze,[e.createElementVNode("div",{class:"area",onMousedown:o[3]||(o[3]=e.withModifiers(l=>{t.mouse.down=!0,H(l)},["self"])),onMousemove:H,onMouseup:o[4]||(o[4]=l=>t.mouse.down=!1),onMouseleave:o[5]||(o[5]=l=>t.mouse.down=!1)},[e.createElementVNode("div",{class:"bar",style:e.normalizeStyle({height:`${t.main.volume*100}%`})},null,4)],32)])]),e.createElementVNode("button",{class:"control-button",title:"Backward",onMousedown:o[6]||(o[6]=l=>{t.mouse.down=!0,x(!1)}),onMouseup:o[7]||(o[7]=l=>{t.mouse.down=!1,x(!1)})},$e,32),e.createElementVNode("button",{class:"control-button",title:"Forward",onMousedown:o[8]||(o[8]=l=>{t.mouse.down=!0,x(!0)}),onMouseup:o[9]||(o[9]=l=>{t.mouse.down=!1,x(!0)})},Re,32),De,e.createElementVNode("div",Fe,[e.createElementVNode("div",He,"x"+e.toDisplayString(((i=t.main.playbackRate)==null?void 0:i.toFixed(1))||"1.0"),1),e.createElementVNode("ul",Pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList([.1,.5,1,1.5,2,5],l=>(e.openBlock(),e.createElementBlock("li",Le,[e.createElementVNode("button",{class:"button",onClick:c=>ot(l)},e.toDisplayString(l.toFixed(1)),9,Ie)]))),256))])]),e.unref(r)?(e.openBlock(),e.createElementBlock("button",{key:0,class:"control-button",title:t.range.enabled?"Reset range":"Set range",onClick:it},[t.range.enabled?(e.openBlock(),e.createElementBlock("svg",Ae,je)):(e.openBlock(),e.createElementBlock("svg",qe,Oe))],8,We)):e.createCommentVNode("",!0),e.unref(m)&&e.unref(w)?(e.openBlock(),e.createElementBlock("button",{key:1,class:e.normalizeClass(["control-button",t.bbox.enabled&&"active"]),title:t.bbox.enabled?"Hide bounding box":"Show bounding box",onClick:at},Ge,10,Ue)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"control-button",title:t.main.fullScreen?"Normal screen":"Full screen",onClick:j},[t.main.fullScreen?(e.openBlock(),e.createElementBlock("svg",Je,Qe)):(e.openBlock(),e.createElementBlock("svg",Ye,Ze))],8,Ke)])],34),e.createElementVNode("div",Xe,[e.createElementVNode("div",{class:e.normalizeClass(["text",t.message.visible?"show":"hide"]),innerHTML:t.message.text},null,10,et)])],8,le)}}},[["__scopeId","data-v-846c9f11"]])});
